<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Log de Actividad</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root{
      --bg:#e6f0ff;
      --fg:#003366;
      --card:#ffffff;
      --accent:#337ab7;
      --accent-hover:#286090;
      --danger:#d9534f;
      --danger-hover:#c9302c;
      --border:#d1d5db;
    }

    *{box-sizing:border-box}
    body{
      font-family:'Segoe UI',sans-serif;
      background-color:var(--bg);
      color:#2c3e50;
      margin:0;
    }

    .topbar{
      background-color:var(--fg);
      color:#fff;
      padding:20px;
      display:flex;
      justify-content:center;
      align-items:center;
      gap:12px;
      position:relative; /* para posicionar el bot√≥n volver */
      border-bottom:3px solid #001f3f;
      box-shadow:0 2px 10px rgba(0,0,0,.2);
    }
    .topbar img{height:70px}
    .topbar .title{
      font-size:26px;
      font-weight:700;
      display:flex;
      align-items:center;
      gap:12px;
    }

    .volver-btn{
      position:absolute;
      top:20px;
      right:20px;
      background-color:var(--danger);
      color:#fff;
      padding:10px 16px;
      border-radius:8px;
      font-weight:700;
      text-decoration:none;
    }
    .volver-btn:hover{background-color:var(--danger-hover)}

    .container{
      max-width:1100px;
      margin:30px auto;
      background:var(--card);
      padding:24px;
      border-radius:12px;
      box-shadow:0 0 12px rgba(0,0,0,.1);
    }

    h2{margin:0 0 18px;text-align:center;color:var(--fg)}

    form{
      margin-bottom:20px;
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      gap:10px;
    }

    label{font-weight:700}

    select,
    input[type="date"]{
      padding:10px 12px;
      border:1px solid var(--border);
      border-radius:10px;
      height:44px;
      background:#fff;
    }

    .btn{
      padding:10px 14px;
      border-radius:10px;
      border:none;
      background-color:var(--accent);
      color:#fff;
      font-weight:700;
      cursor:pointer;
      height:44px;
    }
    .btn:hover{background-color:var(--accent-hover)}

    .btn-danger{background-color:var(--danger)}
    .btn-danger:hover{background-color:var(--danger-hover)}

    .descargar{background-color:#2ecc71}
    .descargar:hover{background-color:#27ae60}

    table{
      width:100%;
      border-collapse:collapse;
      margin-top:15px;
      font-size:14px;
      background:#fff;
    }
    th,td{
      padding:10px;
      border:1px solid #ddd;
      text-align:center;
    }
    th{
      background-color:var(--accent);
      color:#fff;
    }
    tr:nth-child(even){background-color:#f9f9f9}

    @media (max-width:600px){
      .topbar{flex-direction:column;text-align:center}
      .topbar img{height:60px}
      .topbar .title{font-size:20px}
      .volver-btn{top:15px;right:15px;padding:8px 12px;font-size:14px}
      form{flex-direction:column;align-items:stretch}
      table{font-size:12px}
      th,td{padding:6px}
    }
  </style>
</head>
<body>

  <div class="topbar">
    <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo">
    <div class="title">Celulares Cr√©dito F√°cil ‚Äì Log de Actividad</div>
  <a href="/dashboard" class="volver-btn">‚Üê Volver al panel</a>
  </div>

  <div class="container">
    <h2>Log de Actividad</h2>

    <form method="GET">
      <label for="usuario">Usuario:</label>
      <select name="usuario" id="usuario">
        <option value="">Todos</option>
        {% for u in usuarios %}
          <option value="{{ u }}" {% if request.args.get('usuario') == u %}selected{% endif %}>{{ u }}</option>
        {% endfor %}
      </select>

      <label for="accion">Acci√≥n:</label>
      <select name="accion" id="accion">
        <option value="">Todas</option>
        <option value="Inicio de sesi√≥n" {% if request.args.get('accion') == "Inicio de sesi√≥n" %}selected{% endif %}>Inicio de sesi√≥n</option>
        <option value="Cierre de sesi√≥n" {% if request.args.get('accion') == "Cierre de sesi√≥n" %}selected{% endif %}>Cierre de sesi√≥n</option>
        <option value="Registro" {% if request.args.get('accion') == "Registro" %}selected{% endif %}>Registro</option>
        <option value="Eliminaci√≥n" {% if request.args.get('accion') == "Eliminaci√≥n" %}selected{% endif %}>Eliminaci√≥n</option>
        <option value="Transferencia" {% if request.args.get('accion') == "Transferencia" %}selected{% endif %}>Transferencia</option>
        <option value="Restauraci√≥n" {% if request.args.get('accion') == "Restauraci√≥n" %}selected{% endif %}>Restauraci√≥n</option>
      </select>

      <label for="origen">Origen:</label>
      <select name="origen" id="origen">
        <option value="">Todos</option>
        {% for o in origenes %}
          <option value="{{ o }}" {% if origen_actual == o %}selected{% endif %}>{{ o }}</option>
        {% endfor %}
      </select>

      <label for="desde">Desde:</label>
      <input type="date" name="desde" value="{{ request.args.get('desde', '') }}">

      <label for="hasta">Hasta:</label>
      <input type="date" name="hasta" value="{{ request.args.get('hasta', '') }}">

      <button type="submit" class="btn">Filtrar</button>
      <a href="/descargar-log" class="btn descargar">üì• Descargar CSV</a>
    </form>

    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Usuario</th>
          <th>Tipo</th>
          <th>Descripci√≥n</th>
          <th>Fecha</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for r in registros %}
        <tr>
          <td>{{ r[0] }}</td>
          <td>{{ r[1] }}</td>
          <td>{{ r[2] }}</td>
          <td>{{ r[3] }}</td>
          <td>{{ r[4] }}</td>
          <td>
            <form action="/eliminar-log/{{ r[0] }}" method="POST" style="display:inline;" onsubmit="return confirm('¬øSeguro que deseas eliminar este registro?');">
              <button type="submit" class="btn btn-danger">üóëÔ∏è Eliminar</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

</body>
</html>