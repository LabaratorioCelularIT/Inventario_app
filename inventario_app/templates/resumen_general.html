<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Resumen General del Inventario | Celulares Cr√©dito F√°cil</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root{
      --bg:#e6f0ff;
      --fg:#003366;
      --card:#ffffff;
      --accent:#337ab7;
      --accent-hover:#286090;
      --danger:#d9534f;
      --danger-hover:#c9302c;
      --border:#d1d5db;
    }

    *{box-sizing:border-box}
    body{margin:0;font-family:'Segoe UI',Tahoma,sans-serif;background:var(--bg);color:#000}

    .topbar{
      background:var(--fg);
      color:#fff;
      padding:20px;
      display:flex;
      justify-content:center;
      align-items:center;
      border-bottom:3px solid #001f3f;
      box-shadow:0 2px 8px rgba(0,0,0,.2);
      position:relative;
    }
    .topbar .title{display:flex;align-items:center;gap:15px;font-size:26px;font-weight:bold;color:#fff}
    .topbar .title img{height:70px}

    .volver-btn{
      position:absolute; top:20px; right:20px;
      background:var(--danger); color:#fff;
      padding:10px 16px; border-radius:6px; text-decoration:none;
      font-weight:bold; z-index:2;
    }
    .volver-btn:hover{background:var(--danger-hover)}

    .container{
      max-width:1200px;
      margin:30px auto;
      background:var(--card);
      padding:30px;
      border-radius:12px;
      box-shadow:0 0 12px rgba(0,0,0,.08);
    }

    h3{margin:24px 0 10px;color:var(--fg);font-size:22px}

    label{font-weight:600;margin-right:10px;color:var(--fg)}
    select{
      padding:10px 12px;border-radius:10px;border:1px solid var(--border);
      background:#fff;color:#111;font-size:16px;height:44px;
      margin-bottom:15px;
    }

    .table-wrap{overflow:auto;border-radius:10px;border:1px solid #e6e9ef}
    table{width:100%;border-collapse:collapse;background:var(--card)}
    th,td{border:1px solid #e6e9ef;padding:12px;text-align:center}
    th{background:var(--accent);color:#fff}
    tr:nth-child(even){background:#f9f9f9}
    tr:hover{background:#f1f5fb}

    .desglose-section{display:flex;flex-direction:column;gap:30px}
    .sucursal-card{
      background:#f9f9f9;padding:20px;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,.1)
    }
    .sucursal-card h4{margin:0 0 15px;color:var(--fg)}
    .desglose-grid{display:flex;flex-wrap:wrap;gap:15px}
    .desglose-card{
      flex:1 1 220px;background:#fff;border:1px solid #ddd;border-left:6px solid var(--fg);
      padding:12px 16px;border-radius:8px;
    }
    .desglose-card .t{font-weight:700}
    .desglose-card .c{color:#333}

    @media (max-width:600px){
      .topbar{flex-direction:column;text-align:center}
      .topbar .title{flex-direction:column;font-size:20px}
      .topbar .title img{height:60px}
      .volver-btn{font-size:14px;padding:8px 12px;top:15px;right:15px}
      .container{margin:20px;padding:20px}
      /* Tabla m√≥vil tipo ‚Äúcards‚Äù */
      table, thead, tbody, th, td, tr{display:block}
      thead{display:none}
      td{position:relative;padding-left:50%;border:none;border-bottom:1px solid #e6e9ef}
      td::before{
        content:attr(data-label);
        position:absolute; left:10px; top:50%; transform:translateY(-50%);
        font-weight:700; color:#334155;
      }
    }
  </style>

  <script>
    function filtrarTablaSucursal() {
      const valor = document.getElementById("filtroSucursal").value.toLowerCase();
      document.querySelectorAll("#tablaDetalle tbody tr").forEach(tr => {
        const sucursal = tr.getAttribute("data-sucursal")?.toLowerCase() || "";
        tr.style.display = (valor === "" || sucursal.includes(valor)) ? "" : "none";
      });
    }
  </script>
</head>
<body>

  <a class="volver-btn" href="/dashboard">‚¨Ö Volver al Panel</a>

  <div class="topbar">
    <div class="title">
      <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo">
      Celulares Cr√©dito F√°cil ‚Äî Resumen General del Inventario
    </div>
  </div>

  <div class="container">

    <h3>Equipos por Sucursal</h3>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Sucursal</th>
            <th>Total Equipos</th>
          </tr>
        </thead>
        <tbody>
          <tr style="background:#e8f4ff;font-weight:bold;">
            <td data-label="Sucursal">General</td>
            <td data-label="Total Equipos">{{ total_general }}</td>
          </tr>
          {% for sucursal, total in totales_sucursales.items() %}
          <tr>
            <td data-label="Sucursal">{{ sucursal }}</td>
            <td data-label="Total Equipos">{{ total }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <h3>Totales por Tipo y Sucursal</h3>
    <label for="filtroSucursal">Filtrar por sucursal:</label>
    <select id="filtroSucursal" onchange="filtrarTablaSucursal()">
      <option value="">Todas</option>
      {% for suc, _ in totales_sucursales.items() %}
      <option value="{{ suc }}">{{ suc }}</option>
      {% endfor %}
    </select>

    <div class="table-wrap">
      <table id="tablaDetalle">
        <thead>
          <tr>
            <th>Tipo</th>
            <th>Sucursal</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody>
          {% for tipo, registros in resumen_por_tipo.items() %}
            {% for r in registros %}
            <tr data-sucursal="{{ r[1] }}">
              <td data-label="Tipo">{{ r[0] }}</td>
              <td data-label="Sucursal">{{ r[1] }}</td>
              <td data-label="Total">{{ r[2] }}</td>
            </tr>
            {% endfor %}
            <tr style="background:#e3f7e7;font-weight:bold;">
              <td data-label="Tipo">üåü {{ tipo }} (General)</td>
              <td data-label="Sucursal">‚Äî</td>
              <td data-label="Total">{{ totales_modelo[tipo] }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <h3>üì¶ Desglose por Tipo y Estado (por Sucursal)</h3>
    <div class="desglose-section">
      {% for sucursal, registros in desglose_estados.items() %}
      <div class="sucursal-card">
        <h4>üè¨ {{ sucursal }}</h4>
        <div class="desglose-grid">
          {% for tipo, estado, cantidad in registros %}
            {% set bg = '#f2f2f2' %}
            {% if estado == 'Nuevo' %}
              {% set bg = '#e3fce3' %}
            {% elif estado == 'Reparaci√≥n' %}
              {% set bg = '#e3f0fc' %}
            {% elif estado == 'Liquidaci√≥n' %}
              {% set bg = '#fff9da' %}
            {% endif %}
            <div class="desglose-card" style="background: {{ bg }};">
              <div class="t">{{ tipo }}</div>
              <div class="c">{{ cantidad }} {{ estado }}</div>
            </div>
          {% endfor %}
        </div>
      </div>
      {% endfor %}
    </div>

  </div>
</body>
</html>